# FluffyViz Backlog

| Theme | Feature Name | What | How | Goal | Priority | Specific areas in the codebase |
| --- | --- | --- | --- | --- | --- | --- |
| Upload | Flexible Format Detection | Make the upload flow resilient when provider schemas diverge (custom Arize columns, new export versions, inconsistent field names). Current implementation breaks with exact field matching like `context.trace_id` vs `my_trace_id`. | 1. **Config-driven detection**: Move hardcoded patterns from `isArizeObject()` and similar methods to JSON configs supporting multiple format versions<br>2. **Fuzzy matching**: Replace exact string matches with similarity scoring (80%+ threshold) to handle variations like `ctx_trace_id`, `trace_identifier`<br>3. **Semantic patterns**: Detect UUID patterns for trace IDs, timestamp formats, nested structures regardless of field names<br>4. **User mapping UI**: When detection fails, allow users to specify custom field mappings and persist them<br>5. **Confidence cascade**: Exact → Fuzzy → Semantic → User override fallback chain | **Resilience**: Handle real-world export variations without manual intervention<br>**Maintainability**: Schema changes need config updates, not code changes<br>**UX**: Reduce upload failures from ~30% to <5% for valid data<br>**Extensibility**: Easy addition of new providers/versions | High | `fluffy-viz/src/lib/format-detector.ts:218-233` (Arize detection)<br>`fluffy-viz/src/lib/format-detector.ts:127-144` (Langfuse detection)<br>`fluffy-viz/src/components/enhanced-upload.tsx:495-511` (format override)<br>`configs/formats/` (new) |

## Needs to be vetted

| Theme | Feature Name | What | How | Goal | Priority | Specific areas in the codebase |
| --- | --- | --- | --- | --- | --- | --- |
| Security | API Key Management | API keys stored in plain text in component state without encryption. Risk of exposure through memory dumps or debugging tools. | 1. **Secure storage**: Implement encrypted storage for API keys<br>2. **Key masking**: Display masked keys in UI (e.g., `sk-...abc123`)<br>3. **Environment variables**: Move to secure environment variable handling<br>4. **Key validation**: Add format validation per provider before storage | **Security**: Protect user API keys from exposure<br>**Compliance**: Meet security standards for sensitive data<br>**Trust**: Build user confidence in data protection | High | `fluffy-viz/src/components/ai-provider-config-demo.tsx:174,211-229` |
| Security | Unsafe JSON Parsing | Multiple locations parse JSON from user uploads without safety checks, potentially allowing malicious JSON to cause DoS or memory exhaustion. | 1. **Safe parsing**: Implement size limits and timeout for JSON.parse<br>2. **Validation**: Add schema validation before processing<br>3. **Sanitization**: Sanitize parsed content before use<br>4. **Error boundaries**: Add proper error handling for malformed data | **Security**: Prevent malicious JSON attacks<br>**Stability**: Avoid crashes from malformed data<br>**UX**: Provide clear error messages for invalid files | High | `fluffy-viz/src/components/enhanced-upload.tsx:114,124`<br>`fluffy-viz/src/components/app-sidebar.tsx:81-93` |
| Performance | Memory Inefficiency | Large files (1MB+) read entirely into memory causing performance issues and potential browser crashes with multiple large files. | 1. **Streaming**: Implement streaming file processing<br>2. **Chunking**: Process files in chunks rather than all at once<br>3. **Sample-based detection**: Reduce sample size for format detection<br>4. **Progressive loading**: Show progress during large file operations | **Performance**: Handle large datasets without memory issues<br>**UX**: Faster upload processing and better feedback<br>**Scalability**: Support enterprise-size data files | High | `fluffy-viz/src/lib/format-detector.ts:38-50`<br>`fluffy-viz/src/lib/data-processor.ts:81-87` |
| Performance | Race Conditions | Database initialization can race when multiple operations start simultaneously, causing data corruption or failures. | 1. **Singleton pattern**: Implement proper singleton with promise caching<br>2. **Mutex locks**: Add locking for initialization operations<br>3. **Queue operations**: Queue operations until initialization completes<br>4. **Error recovery**: Add retry logic for failed initialization | **Reliability**: Prevent data corruption from race conditions<br>**UX**: Consistent behavior across operations<br>**Maintainability**: Predictable initialization flow | High | `fluffy-viz/src/hooks/use-file-storage.ts:41-42,57-58` |
| Architecture | Component Size | Multiple components exceed 400+ lines with mixed responsibilities, making them hard to test, maintain, and reason about. | 1. **Component splitting**: Break large components into focused sub-components<br>2. **Custom hooks**: Extract stateful logic into reusable hooks<br>3. **Separation of concerns**: Separate UI, business logic, and data fetching<br>4. **Composition**: Use composition patterns for better reusability | **Maintainability**: Easier to understand and modify components<br>**Testability**: Smaller units are easier to test<br>**Reusability**: Components can be reused across the app<br>**Team productivity**: Faster development and debugging | High | `fluffy-viz/src/components/enhanced-upload.tsx` (656 lines)<br>`fluffy-viz/src/components/ai-provider-config-demo.tsx` (475 lines)<br>`fluffy-viz/src/app/page.tsx` (320+ lines) |
| Architecture | React Anti-patterns | Using custom DOM events and direct DOM manipulation instead of React patterns, breaking React's data flow and causing potential memory leaks. | 1. **React Context**: Replace custom events with React Context for global state<br>2. **State lifting**: Lift state to common ancestors instead of events<br>3. **Refs for DOM**: Use useRef for DOM operations instead of getElementById<br>4. **Cleanup**: Ensure proper cleanup of event listeners | **Maintainability**: Follow React best practices<br>**Performance**: Reduce memory leaks and improve efficiency<br>**Debugging**: Better integration with React DevTools<br>**Predictability**: More predictable data flow | High | `fluffy-viz/src/components/app-sidebar.tsx:43-46`<br>`fluffy-viz/src/app/page.tsx:47-60,52` |
| SEO | Missing Metadata | Generic Next.js metadata hurts SEO and social sharing. No page-specific metadata for different routes. | 1. **App metadata**: Update layout.tsx with proper application metadata<br>2. **Page metadata**: Add metadata exports to each page<br>3. **OpenGraph**: Add social sharing metadata<br>4. **Structured data**: Consider adding JSON-LD for better search visibility | **SEO**: Improve search engine visibility<br>**Social sharing**: Better previews when shared<br>**Branding**: Professional appearance in search results<br>**User acquisition**: Better discoverability | Medium | `fluffy-viz/src/app/layout.tsx:15-18`<br>`fluffy-viz/src/app/style-guide/page.tsx` (missing metadata) |
| Performance | Image Optimization | Using standard img tags instead of Next.js Image component, missing optimization for Core Web Vitals and loading performance. | 1. **Next.js Image**: Replace all img tags with next/image<br>2. **Format optimization**: Enable WebP/AVIF formats<br>3. **Lazy loading**: Implement proper lazy loading strategies<br>4. **Size optimization**: Add responsive image sizing | **Performance**: Better Core Web Vitals scores<br>**SEO**: Improved page speed rankings<br>**UX**: Faster page loads and better mobile experience<br>**Bandwidth**: Reduced data usage for users | Medium | `fluffy-viz/src/app/page.tsx:117-121,131-136` |
| Performance | Unnecessary Re-renders | Multiple performance issues causing unnecessary component re-renders and degraded user experience. | 1. **Memoization**: Add React.memo, useMemo, useCallback where needed<br>2. **Dependency optimization**: Fix dependency arrays in useEffect<br>3. **State structuring**: Optimize state structure to reduce re-renders<br>4. **Component splitting**: Separate static and dynamic parts | **Performance**: Smoother user interactions<br>**Battery life**: Reduced CPU usage on mobile devices<br>**Scalability**: Better performance with large datasets<br>**UX**: More responsive interface | Medium | `fluffy-viz/src/components/enhanced-upload.tsx:112,122,136`<br>`fluffy-viz/src/components/app-header.tsx:9`<br>`fluffy-viz/src/hooks/use-file-storage.ts:147` |
| Type Safety | Weak Typing | Extensive use of 'any' types and missing interfaces reduce type safety and IntelliSense support. | 1. **Strict typing**: Replace 'any' with specific interfaces<br>2. **Type guards**: Add runtime type validation functions<br>3. **Generic types**: Use generics for reusable type-safe functions<br>4. **Zod integration**: Add runtime schema validation with Zod | **Developer experience**: Better IntelliSense and error catching<br>**Reliability**: Catch type errors at compile time<br>**Maintainability**: Self-documenting code through types<br>**Refactoring safety**: Confident refactoring with type checking | Medium | `fluffy-viz/src/lib/format-detector.ts:67,111,157,201`<br>`fluffy-viz/src/lib/data-processor.ts:100,159,211,257,314`<br>`fluffy-viz/src/types/agent-data.ts:10` |
| Error Handling | Silent Failures | Multiple empty catch blocks and missing error boundaries hide failures from users and developers. | 1. **Error logging**: Implement proper error logging system<br>2. **Error boundaries**: Add React error boundaries<br>3. **User feedback**: Show meaningful error messages to users<br>4. **Error recovery**: Add retry mechanisms where appropriate | **UX**: Users understand what went wrong<br>**Debugging**: Easier to diagnose issues in production<br>**Reliability**: Graceful handling of edge cases<br>**Support**: Better error reporting for user support | Medium | `fluffy-viz/src/lib/format-detector.ts:79-81,105-122,172-175,206-209`<br>`fluffy-viz/src/lib/data-processor.ts:144-147,197-199,243-245,293-295` |
| Accessibility | Missing Standards | Components lack proper ARIA attributes, keyboard navigation, and screen reader support. | 1. **ARIA attributes**: Add proper ARIA labels and roles<br>2. **Keyboard navigation**: Implement proper tab order and keyboard shortcuts<br>3. **Screen reader**: Test and optimize for screen readers<br>4. **Focus management**: Proper focus management in modals and dynamic content | **Accessibility**: Compliant with WCAG guidelines<br>**Inclusivity**: Usable by users with disabilities<br>**Legal compliance**: Meet accessibility requirements<br>**User base**: Expanded potential user base | Medium | `fluffy-viz/src/components/enhanced-upload.tsx:334-347`<br>`fluffy-viz/src/components/workflow-breadcrumb.tsx:156,162` |
| Configuration | Development Tools | Missing essential development tools like Prettier, Husky, and proper linting setup affecting code quality and team consistency. | 1. **Prettier**: Add code formatting configuration<br>2. **Pre-commit hooks**: Set up Husky and lint-staged<br>3. **Bundle analyzer**: Add webpack bundle analyzer<br>4. **Environment validation**: Add env variable validation with Zod | **Code quality**: Consistent formatting and style<br>**Team productivity**: Reduced code review friction<br>**Performance monitoring**: Better build optimization insights<br>**Error prevention**: Catch issues before deployment | Medium | Project root (missing prettier.config.js, .husky/)<br>`fluffy-viz/next.config.ts` (minimal config) |
| SSR Compatibility | Hydration Issues | Multiple components access browser APIs without SSR safety checks, causing hydration mismatches. | 1. **SSR guards**: Add typeof window checks<br>2. **Dynamic imports**: Use dynamic imports for client-only components<br>3. **useEffect patterns**: Move browser API calls to useEffect<br>4. **Testing**: Add SSR testing to prevent regressions | **Reliability**: Prevent hydration errors<br>**SEO**: Ensure proper server-side rendering<br>**Performance**: Avoid client-side re-rendering<br>**User experience**: Faster initial page loads | Medium | `fluffy-viz/src/components/theme-toggle.tsx:12-13`<br>`fluffy-viz/src/hooks/use-mobile.ts:9,11,14` |
| Code Quality | Technical Debt | Code duplication, magic numbers, and dead code throughout the codebase affecting maintainability. | 1. **Extract constants**: Move magic numbers to named constants<br>2. **Remove dead code**: Clean up commented code and unused variables<br>3. **DRY principle**: Extract common patterns into reusable utilities<br>4. **Documentation**: Add JSDoc comments for complex functions | **Maintainability**: Easier to modify and extend code<br>**Onboarding**: New developers can understand code faster<br>**Bug reduction**: Less duplication means fewer places for bugs<br>**Refactoring confidence**: Clear code structure for safe changes | Low | `fluffy-viz/src/lib/format-detector.ts:13,44,65,109,155,200,242,342,350`<br>`fluffy-viz/src/app/page.tsx:22,160-219` (dead code)<br>`fluffy-viz/src/components/workflow-breadcrumb.tsx:18-191` (duplication) |
| Performance | Workspace Configuration | Next.js workspace root warning indicates potential build performance issues and incorrect dependency resolution. | 1. **Fix workspace root**: Add outputFileTracingRoot to next.config.ts<br>2. **Clean lockfiles**: Remove unnecessary parent lockfiles<br>3. **Monorepo setup**: If needed, properly configure for monorepo<br>4. **Build optimization**: Add bundle analysis and optimization | **Build performance**: Faster builds and deployments<br>**Dependency resolution**: Correct module resolution<br>**Development experience**: Eliminate warning noise<br>**Production stability**: Predictable builds | Low | `fluffy-viz/next.config.ts` (needs outputFileTracingRoot)<br>Parent directory lockfile conflicts |
